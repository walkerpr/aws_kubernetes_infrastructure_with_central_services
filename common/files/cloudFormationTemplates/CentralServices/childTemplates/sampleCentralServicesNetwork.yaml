AWSTemplateFormatVersion: 2010-09-09
Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Parameters:
          - pSubnetCidrA
          - pEnvironment
Parameters:
  pSAMPLEEnv:
    Type: String
    Description: Production? Test?
    AllowedValues:
      - prod
      - test
  pSubnetCidrA:
    Type: String
    Description: Choose the CIDR for the new subnet.
  pSubnetCidrB:
    Type: String
    Description: Choose the CIDR for the new subnet.
  pSubnetCidrC:
    Description: The CIDR of the second subnet.
    Type: String
  pSubnetCidrD:
    Description: The CIDR of the second subnet.
    Type: String
  pSubnetCidrE:
    Description: The CIDR of the second subnet.
    Type: String
  pSubnetCidrF:
    Description: The CIDR of the second subnet.
    Type: String
  pSubnetCidrG:
    Description: The CIDR of the second subnet.
    Type: String
  pEnvironment:
    Type: String
    Description: Development? Test Upstream? Prod Upstream?
    AllowedValues:
      - dev
      - upprod
      - uptest
  pVpcId:
    Description: The VPC-scoped resources will belong to this VPC.
    Type: AWS::EC2::VPC::Id
  pVpcCidr:
    Description: The VPC-scoped resources will belong to this VPC.
    Type: String
  pVpcCidr1:
    Type: String
    Default: "192.168.1.1/32"
  pVpcCidr2:
    Type: String
    Default: "192.168.1.1/32"
  pVpcCidr3:
    Type: String
    Default: "192.168.1.1/32"
  pVpcCidr4:
    Type: String
    Default: "192.168.1.1/32"
  pTGWId:
    Description: The VPC-scoped resources will belong to this VPC.
    Type: String
  pUpTestCIDR0:
    Type: String
  pUpTestCIDR1:
    Type: String
  pUpProdCIDR0:
    Type: String
  pUpProdCIDR1:
    Type: String
  pPeeringIdUpTest:
    Type: String
  pPeeringIdUpProd:
    Type: String
  pDevCidr0:
    Type: String
  pDevCidr1:
    Type: String
  pDevCidr2:
    Type: String
  pDevCidr3:
    Type: String
  pDevCidr4:
    Type: String
  pUpprodPeeringID:
    Type: String
  pUptestPeeringID:
    Type: String
Conditions:
  ProdSubnetParameters: !Equals
    - !Ref pSAMPLEEnv
    - "prod"
  TestSubnetParameters: !Equals
    - !Ref pSAMPLEEnv
    - "test"
  Dev: !Equals
    - !Ref pEnvironment
    - "dev"
  ProductionDev: !And
    - !Condition ProdSubnetParameters
    - !Condition Dev
  Upstream: !Or
    - !Equals
      - upprod
      - !Ref pEnvironment
    - !Equals
      - uptest
      - !Ref pEnvironment
  Uptest: !Equals
    - !Ref pEnvironment
    - "uptest"
  Upprod: !Equals
    - !Ref pEnvironment
    - "upprod"
Resources:
  sampleVPCPrefix:
    Type: AWS::EC2::PrefixList
    DeletionPolicy: Retain
    Properties:
      AddressFamily: IPv4
      Entries:
        !If
          - ProductionDev
          - - Cidr: !Ref pVpcCidr
            - Cidr: !Ref pVpcCidr1
            - Cidr: !Ref pVpcCidr2
            - Cidr: !Ref pVpcCidr3
            - Cidr: !Ref pVpcCidr4
          - - Cidr: !Ref pVpcCidr
            - Cidr: !Ref pVpcCidr1
      MaxEntries: 5
      PrefixListName: !Sub sample-${pEnvironment}-vpc-cidr-prefix
  sampleSubnetPrefix:
    Type: AWS::EC2::PrefixList
    DeletionPolicy: Retain
    Properties:
      AddressFamily: IPv4
      Entries:
        - Cidr: !Ref pSubnetCidrA
        - Cidr: !Ref pSubnetCidrB
        - Cidr: !Ref pSubnetCidrC
        - Cidr: !Ref pSubnetCidrD
        - Cidr: !Ref pSubnetCidrE
        - Cidr: !Ref pSubnetCidrF
        - Cidr: !Ref pSubnetCidrG
      MaxEntries: 8
      PrefixListName: !Sub sample-${pEnvironment}-central-services-subnet-cidr-prefix
  sampleVPCFlowLogsRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - vpc-flow-logs.amazonaws.com
            Action:
              - sts:AssumeRole
      Path: /
      RoleName: sampleVPCFlowLogRole
  sampleVPCFlowLogsManagedPolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
      Description: "sampleVPCFlowLogsRolePolicy"
      ManagedPolicyName: sampleVPCFlowLogsRolePolicy
      PolicyDocument:
        Version: 2012-10-17
        Statement:
          - Effect: Allow
            Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
              - logs:DescribeLogGroups
              - logs:DescribeLogStreams
            Resource: "*"
      Roles:
        - !Ref sampleVPCFlowLogsRole
  sampleVPCFlowLogsLogGroup:
    Type: AWS::Logs::LogGroup
    DeletionPolicy: Delete
    Properties:
      LogGroupName: /aws/vpc/sampleVPCFlowLogs
      RetentionInDays: 365
  sampleVPCFlowLogsLog:
    Type: AWS::EC2::FlowLog
    DeletionPolicy: Delete
    Properties:
      DeliverLogsPermissionArn: !GetAtt sampleVPCFlowLogsRole.Arn
      LogGroupName: !Ref sampleVPCFlowLogsLogGroup
      ResourceId: !Ref pVpcId
      ResourceType: VPC
      TrafficType: ALL
      MaxAggregationInterval: 60
  sampleCentralServicesSubnetA:
    Type: AWS::EC2::Subnet
    Properties:
      AssignIpv6AddressOnCreation: false
      AvailabilityZone: us-gov-west-1a
      CidrBlock: !Ref pSubnetCidrA
      EnableDns64: false
      MapPublicIpOnLaunch: false
      Tags:
        - Key: "deploymentType"
          Value: centralServices
        - Key: Name
          Value: !Sub "sample-central-services-subnet-a"
      VpcId: !Ref pVpcId
  sampleCentralServicesSubnetAID:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/a/id"
      Type: String
      Value: !Ref sampleCentralServicesSubnetA
      Description: SSM Parameter for Central Services Subnet ID
  sampleCentralServicesSubnetACIDR:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/a/cidr"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetA.CidrBlock
      Description: SSM Parameter for Central Services Subnet CIDR
  sampleCentralServicesSubnetsampleZ:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/a/az"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetA.AvailabilityZone
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetsampleZId:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/a/azid"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetA.AvailabilityZoneId
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetB:
    Type: AWS::EC2::Subnet
    Properties:
      AssignIpv6AddressOnCreation: false
      AvailabilityZone: us-gov-west-1b
      CidrBlock: !Ref pSubnetCidrB
      EnableDns64: false
      MapPublicIpOnLaunch: false
      Tags:
        - Key: "deploymentType"
          Value: centralServices
        - Key: Name
          Value: !Sub "sample-central-services-subnet-b"
      VpcId: !Ref pVpcId
  sampleCentralServicesSubnetBID:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/b/id"
      Type: String
      Value: !Ref sampleCentralServicesSubnetB
      Description: SSM Parameter for Central Services Subnet ID
  sampleCentralServicesSubnetBCIDR:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/b/cidr"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetB.CidrBlock
      Description: SSM Parameter for Central Services Subnet CIDR
  sampleCentralServicesSubnetBAZ:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/b/az"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetB.AvailabilityZone
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetBAZId:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/b/azid"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetB.AvailabilityZoneId
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetC:
    Type: AWS::EC2::Subnet
    Properties:
      AssignIpv6AddressOnCreation: false
      AvailabilityZone: us-gov-west-1a
      CidrBlock: !Ref pSubnetCidrC
      EnableDns64: false
      MapPublicIpOnLaunch: false
      Tags:
        - Key: "deploymentType"
          Value: centralServices
        - Key: Name
          Value: !Sub "sample-central-services-subnet-c"
      VpcId: !Ref pVpcId
  sampleCentralServicesSubnetCID:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/c/id"
      Type: String
      Value: !Ref sampleCentralServicesSubnetC
      Description: SSM Parameter for Central Services Subnet ID
  sampleCentralServicesSubnetCCIDR:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/c/cidr"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetC.CidrBlock
      Description: SSM Parameter for Central Services Subnet CIDR
  sampleCentralServicesSubnetCAZ:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/c/az"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetC.AvailabilityZone
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetCAZId:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/c/azid"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetC.AvailabilityZoneId
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetD:
    Type: AWS::EC2::Subnet
    Properties:
      AssignIpv6AddressOnCreation: false
      AvailabilityZone: us-gov-west-1b
      CidrBlock: !Ref pSubnetCidrD
      EnableDns64: false
      MapPublicIpOnLaunch: false
      Tags:
        - Key: "deploymentType"
          Value: centralServices
        - Key: Name
          Value: !Sub "sample-central-services-subnet-d"
      VpcId: !Ref pVpcId
  sampleCentralServicesSubnetDID:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/d/id"
      Type: String
      Value: !Ref sampleCentralServicesSubnetD
      Description: SSM Parameter for Central Services Subnet ID
  sampleCentralServicesSubnetDCIDR:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/d/cidr"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetD.CidrBlock
      Description: SSM Parameter for Central Services Subnet CIDR
  sampleCentralServicesSubnetDAZ:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/d/az"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetD.AvailabilityZone
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetDAZId:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/d/azid"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetD.AvailabilityZoneId
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetE:
    Type: AWS::EC2::Subnet
    Properties:
      AssignIpv6AddressOnCreation: false
      AvailabilityZone: us-gov-west-1a
      CidrBlock: !Ref pSubnetCidrE
      EnableDns64: false
      MapPublicIpOnLaunch: false
      Tags:
        - Key: "deploymentType"
          Value: centralServices
        - Key: Name
          Value: !Sub "sample-central-services-subnet-e"
      VpcId: !Ref pVpcId
  sampleCentralServicesSubnetEID:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/e/id"
      Type: String
      Value: !Ref sampleCentralServicesSubnetE
      Description: SSM Parameter for Central Services Subnet ID
  sampleCentralServicesSubnetECIDR:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/e/cidr"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetE.CidrBlock
      Description: SSM Parameter for Central Services Subnet CIDR
  sampleCentralServicesSubnetEAZ:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/e/az"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetE.AvailabilityZone
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetEAZId:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/e/azid"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetE.AvailabilityZoneId
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetF:
    Type: AWS::EC2::Subnet
    Properties:
      AssignIpv6AddressOnCreation: false
      AvailabilityZone: us-gov-west-1a
      CidrBlock: !Ref pSubnetCidrF
      EnableDns64: false
      MapPublicIpOnLaunch: false
      Tags:
        - Key: "deploymentType"
          Value: centralServices
        - Key: Name
          Value: !Sub "sample-central-services-subnet-f"
      VpcId: !Ref pVpcId
  sampleCentralServicesSubnetFID:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/f/id"
      Type: String
      Value: !Ref sampleCentralServicesSubnetF
      Description: SSM Parameter for Central Services Subnet ID
  sampleCentralServicesSubnetFCIDR:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/f/cidr"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetF.CidrBlock
      Description: SSM Parameter for Central Services Subnet CIDR
  sampleCentralServicesSubnetFAZ:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/f/az"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetF.AvailabilityZone
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetFAZId:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/f/azid"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetF.AvailabilityZoneId
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetG:
    Type: AWS::EC2::Subnet
    Properties:
      AssignIpv6AddressOnCreation: false
      AvailabilityZone: us-gov-west-1b
      CidrBlock: !Ref pSubnetCidrG
      EnableDns64: false
      MapPublicIpOnLaunch: false
      Tags:
        - Key: "deploymentType"
          Value: centralServices
        - Key: Name
          Value: !Sub "sample-central-services-subnet-g"
      VpcId: !Ref pVpcId
  sampleCentralServicesSubnetGID:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/g/id"
      Type: String
      Value: !Ref sampleCentralServicesSubnetG
      Description: SSM Parameter for Central Services Subnet ID
  sampleCentralServicesSubnetGCIDR:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/g/cidr"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetG.CidrBlock
      Description: SSM Parameter for Central Services Subnet CIDR
  sampleCentralServicesSubnetGAZ:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/g/az"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetG.AvailabilityZone
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetGAZId:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/sample-central-services-subnet/g/azid"
      Type: String
      Value: !GetAtt sampleCentralServicesSubnetG.AvailabilityZoneId
      Description: SSM Parameter for Central Services Subnet AZ
  sampleCentralServicesSubnetRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      Tags:
        - Key: "deploymentType"
          Value: centralServices
        - Key: Name
          Value: !Sub "sample-central-services-rt"
      VpcId: !Ref pVpcId
  sampleCentralServicesSubnetTGWRoute:
    Type: AWS::EC2::Route
    DependsOn: sampleCentralServicesSubnetRouteTable
    Properties:
      RouteTableId: !Ref sampleCentralServicesSubnetRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      TransitGatewayId: !Ref pTGWId
  sampleCentralServicesSubnetARouteTableAssociation:
    DependsOn:
      - sampleCentralServicesSubnetRouteTable
      - sampleCentralServicesSubnetA
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref sampleCentralServicesSubnetRouteTable
      SubnetId: !Ref sampleCentralServicesSubnetA
  sampleCentralServicesSubnetBRouteTableAssociation:
    DependsOn:
      - sampleCentralServicesSubnetRouteTable
      - sampleCentralServicesSubnetB
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref sampleCentralServicesSubnetRouteTable
      SubnetId: !Ref sampleCentralServicesSubnetB
  sampleCentralServicesSubnetCRouteTableAssociation:
    DependsOn:
      - sampleCentralServicesSubnetRouteTable
      - sampleCentralServicesSubnetC
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref sampleCentralServicesSubnetRouteTable
      SubnetId: !Ref sampleCentralServicesSubnetC
  sampleCentralServicesSubnetDRouteTableAssociation:
    DependsOn:
      - sampleCentralServicesSubnetRouteTable
      - sampleCentralServicesSubnetD
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref sampleCentralServicesSubnetRouteTable
      SubnetId: !Ref sampleCentralServicesSubnetD
  sampleCentralServicesSubnetERouteTableAssociation:
    DependsOn:
      - sampleCentralServicesSubnetRouteTable
      - sampleCentralServicesSubnetE
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref sampleCentralServicesSubnetRouteTable
      SubnetId: !Ref sampleCentralServicesSubnetE
  sampleCentralServicesSubnetFRouteTableAssociation:
    DependsOn:
      - sampleCentralServicesSubnetRouteTable
      - sampleCentralServicesSubnetF
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref sampleCentralServicesSubnetRouteTable
      SubnetId: !Ref sampleCentralServicesSubnetF
  sampleCentralServicesSubnetGRouteTableAssociation:
    DependsOn:
      - sampleCentralServicesSubnetRouteTable
      - sampleCentralServicesSubnetG
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      RouteTableId: !Ref sampleCentralServicesSubnetRouteTable
      SubnetId: !Ref sampleCentralServicesSubnetG
  sampleVPCIDParameter:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/id"
      Type: String
      Value: !Ref pVpcId
  sampleVPCCPrefixParameter:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/cidr/prefix"
      Type: String
      Value: !Ref sampleVPCPrefix
  sampleSubnetCIDRParameter:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/central-services/subnet/cidr/prefix"
      Type: String
      Value: !Ref sampleSubnetPrefix
  sampleTGWIDParameter:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/sample-${pEnvironment}-${pSAMPLEEnv}-vpc/tgw/id"
      Type: String
      Value: !Ref pTGWId
  sampleUpProdPrefix:
    Type: AWS::EC2::PrefixList
    Condition: ProductionDev
    Properties:
      AddressFamily: IPv4
      Entries:
        - Cidr: !Ref pUpProdCIDR0
        - Cidr: !Ref pUpProdCIDR1
      MaxEntries: 5
      PrefixListName: sample-upprod-upstream-prefix
  sampleUpTestPrefix:
    Type: AWS::EC2::PrefixList
    Condition: ProductionDev
    Properties:
      AddressFamily: IPv4
      Entries:
        - Cidr: !Ref pUpTestCIDR0
        - Cidr: !Ref pUpTestCIDR1
      MaxEntries: 5
      PrefixListName: sample-uptest-upstream-prefix
  sampleUpProdVPCPeeringRoute:
    Condition: ProductionDev
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref sampleCentralServicesSubnetRouteTable
      DestinationPrefixListId: !Ref sampleUpProdPrefix
      VpcPeeringConnectionId: !Ref pPeeringIdUpProd
  sampleUpTestVPCPeeringRoute:
    Condition: ProductionDev
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref sampleCentralServicesSubnetRouteTable
      DestinationPrefixListId: !Ref sampleUpTestPrefix
      VpcPeeringConnectionId: !Ref pPeeringIdUpTest
  sampleDevPrefix:
    Type: AWS::EC2::PrefixList
    Condition: Upstream
    Properties:
      AddressFamily: IPv4
      Entries:
        - Cidr: !Ref pDevCidr0
        - Cidr: !Ref pDevCidr1
        - Cidr: !Ref pDevCidr2
        - Cidr: !Ref pDevCidr3
      MaxEntries: 6
      PrefixListName: !Sub sample-production-dev-cidr-prefix
  DevSubnetPrefixParameter:
    Type: AWS::SSM::Parameter
    Condition: Upstream
    Properties:
      Name: !Sub "/sample/vpc/prod/prefix/dev/id"
      Type: String
      Value: !Ref sampleDevPrefix
      Description: SSM Parameter for Prod Central Services Prefix ID
  vpcUpstreamPeeringRoute:
    Type: AWS::EC2::Route
    Condition: Upstream
    Properties:
      RouteTableId: !Ref sampleCentralServicesSubnetRouteTable
      DestinationPrefixListId: !Ref sampleDevPrefix
      VpcPeeringConnectionId: !If
        - Upprod
        - !Ref pPeeringIdUpProd
        - !Ref pPeeringIdUpTest
  vpcUpprodPeeringID:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/peering/upprod/id"
      Type: String
      Value: !Ref pPeeringIdUpProd
  vpcUptestPeeringID:
    Type: AWS::SSM::Parameter
    Properties:
      Name: !Sub "/sample/vpc/peering/uptest/id"
      Type: String
      Value: !Ref pPeeringIdUpTest
Outputs:
  sampleCentralServicesSubnetsampleZId:
    Value: !GetAtt sampleCentralServicesSubnetA.AvailabilityZoneId